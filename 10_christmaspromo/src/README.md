# 미션 - 크리스마스 프로모션

#### 기대하는 '12월 이벤트 플래너'의 예시 모습

```
안녕하세요! 우테코 식당 12월 이벤트 플래너입니다.
12월 중 식당 예상 방문 날짜는 언제인가요? (숫자만 입력해 주세요!)
3
주문하실 메뉴를 메뉴와 개수를 알려 주세요. (e.g. 해산물파스타-2,레드와인-1,초코케이크-1)
티본스테이크-1,바비큐립-1,초코케이크-2,제로콜라-1
12월 3일에 우테코 식당에서 받을 이벤트 혜택 미리 보기!

<주문 메뉴>
티본스테이크 1개
바비큐립 1개
초코케이크 2개
제로콜라 1개

<할인 전 총주문 금액>
142,000원

<증정 메뉴>
샴페인 1개

<혜택 내역>
크리스마스 디데이 할인: -1,200원
평일 할인: -4,046원
특별 할인: -1,000원
증정 이벤트: -25,000원

<총혜택 금액>
-31,246원

<할인 후 예상 결제 금액>
135,754원

<12월 이벤트 배지>
산타
```

## 설계

프로그램의 실행 과정을 정리하면 다음과 같다.

1. 메뉴저장
2. 방문 날짜 입력
3. 주문할 메뉴 입력 -> 검증
4. 총 주문 금액 구함 -> 이벤트 적용 가능여부 확인
5. 이벤트 적용
6. 결과 출력

이 내용에 맞춰서 설계한 파일들은 다음과 같다.

### View

1. InputView

- 사용자 입력

2. OutputView

- 출력

### Controller

1. PromoController

- 프로그램 컨트롤

### Model

1. Menu

- 메뉴 파싱
- 메뉴 저장

2. Validator

- 입력된 내용 검증

3. Order

- 사용자 오더 관리
- 방문날짜
- 주문메뉴
- 총 주문금액
- 증정 메뉴
- 혜택 내역
- 할인 금액

4. Calculator

- Order에 입력된 내용을 통해 할인 적용

## 구현 체크리스트

### InputView

- [x] 방문 날짜 입력
- [x] 주문 메뉴 입력

### OutputView

- [x] 주문 메뉴 출력
- [x] 총 주문 금액 출력
- [x] 증정 메뉴 출력
- [x] 혜택 내역 출력
- [x] 총 혜택 금액 출력
- [x] 할인 후 예상 결제 금액 출력
- [x] 이벤트 배지 출력

### PromoController

- [x] 메뉴 저장
- [x] 방문 날짜 입력 받아 order로 전달
- [x] 주문할 메뉴 입력 받아 Validator
- [x] 검증 후 calculator로 전달
- [x] 결과 받아와 출력

### Customer

- [x] 방문날짜
- [x] 주문 메뉴
- [x] 총 주문 금액
- [x] 증정 메뉴
- [x] 혜택 내역
- [x] 할인금액

### Order

- [x] 총 주문 금액 계산 후 customer에 저장
- [x] 이벤트 적용 여부 판단
- [x] 크리스마스 디데이 할인 적용
- [x] 평일 or 주말 할인 적용
  - [x] 날짜 요일 확인
  - [x] 요일에 따라 서로 다른 로직 적용
- [x] 특별 할인 적용
- [x] 증정 할인 적용

### Menu

- [x] 메뉴 저장

### Validator

- [x] 방문할 날짜
  - [x] 숫자인가
  - [x] 정수인가
  - [x] 1 이상 31 이하인가
- [x] 주문 메뉴
  - [x] ','로 split
  - [x] split된 배열에 빈배열 있으면 에러
  - [x] 각 배열 '-'로 split
  - [x] split된 배열에 빈배열 있으면 에러
  - [x] 파싱(배열 안에 객체들)
  - [x] name 중복 여부
  - [x] 개수 검증
    - [x] 숫자인가
    - [x] 정수인가
    - [x] 1 이상인가
  - [x] 메뉴에 있는가

## 구현

구현 과정에서 변경된 부분은 기존 Calculator, Order로 나눠놨던 내용을 Order, Customer로 변경했다.

### Order

주문 자체를 다루는 내용이 담겨져있다.

- 총 금액 구하기
- 이벤트 적용 여부 확인
- 각 이벤트 적용

### Customer

해당 주문을 한 고객에 대한 정보가 담겨져있다. Order가 customer 내부의 정보를 계속해서 수정하게 된다.
<br />
담겨져있는 내용은

- 방문 날짜
- 주문 메뉴
- 총 주문 금액
- 증정 메뉴
- 혜택 내역
- 할인 금액

이렇게 되어있고, controller에서 order를 실행한 후(해당 오더에 대한 처리 진행) 결과를 가져와 출력하게 될 때에는 이 customer 내부에 있는 정보를 가져와 출력하게 된다.

### Menu

메뉴에 대한 내용은 미션 내용에 나와있지 않아 내가 다루기 쉬운 방식이 배열안에 들어있는 객체?를 사용하였다.

```js
export const Menu = [
  {
    name: '양송이수프',
    type: '에피타이저',
    price: 6000,
  },
  {
    name: '타파스',
    type: '에피타이저',
    price: 5500,
  },
];
```

### Controller

controller의 경우 result를 출력하는 로직이 자리를 많이 차지할 뿐, 제대로된 처리 로직은 order에서 하고 있기 때문에 단순했다.

1. 날짜 가져옴
2. 날짜 검증
3. 주문 가져옴
4. 주문 파싱
5. 주문 검증
6. customer 생성
7. order 생성 및 돌림

## 디버깅

계속해서 문제를 풀어나가고 있지만, 매번 마지막에 try-catch 구문을 사용 -> console에 error.message가 출력되게 하는 부분을 빼먹어서 계속 테스트에서 헤매는 느낌이 들고 있다. <br />
또한 이번 미션에서 많이 헷갈렸던 부분은 총 주문 금액이었는데, 에상되는 총 주문금액의 2배가 계속해서 찍히길래 왜 이러나 고민을 했었다. 결론은 총 주문금액을 구하는 로직에서 customer 내부의 총 주문 금액을 갱신하는(더하는) 로직이 함께 있었어서 이 로직을 통해 총 주문금액을 구하게 되면 구할 때마다 주문 금액이 더해지게 된다. 따라서 order의 인스턴스에 총 주문금액을 넣어버렸다.
<br />
menu의 경우 하드코딩해서 내가 다루기 쉬운 방식으로 넣을 수 있었지만, 만약에 CSV로 나온다면? 이런 생각을 계속해봐야할 것 같다. 아직 배열, obj 등등을 구별해서 다루는 부분에 미숙해서 오류가 나면 변경하는 방식을 사용 중인데 이 부분을 제대로 공부하는게 좋을 것 같다. <br />

## 리팩토링

다 푸니 3시간 20분 정도 지났길래 리팩토링을 추가로 시도하였다.
<br />
현재 구조는 Order에서 모든 promo를 처리하고 있는데, 이를 분리하기 위해서 events를 새로 만들어 내부에 각 할인 이벤트에 해당되는 클래스들을 만들었다.

```js
class SpecialPromo {
  canApply(date, order) {
    const arr = [3, 10, 17, 24, 25, 31];
    return arr.includes(date);
  }

  apply(date, order, customer) {
    customer.setFreeAmount('특별 할인', 1000);
  }
}

export default SpecialPromo;
```

그리고 `EventCalculator`를 생성하여 -> 모든 promo를 담당하는 이벤트들을 돌 수 있게 하였고, 증정 이벤트는 total을 확인해야해서 기존에 있던 Order에서 추가하였다.
