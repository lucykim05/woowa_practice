# 페어매칭

## 요구사항

### 페어 매칭 기능

1. 페어 매칭 조건

- 미션을 함께 수행할 페어를 두명씩 매칭한다.
- 페어 매칭 대상이 홀수인 경우 한 페어는 3인으로 구성한다.
- 같은 레벨에서 이미 페어를 맺은 크루와는 다시 페어로 매칭될 수 없다.

2. 페어 매칭 구현 방법

- 크루들의 이름 목록을 배열로 준비
- 크루 목록의 순서를 랜덤으로 섞는다. Random.shuffle 사용 (현재는 숫자만 가능하니 숫자로 변환하여 사용)
- 앞에서부터 순서대로 매칭
- 홀수인 경우 마지막 남은 크루는 마지막 페어에 포함 시킴
- 같은 레벨에서 이미 만난적 있으면 다시 페어로 설정x
- 3회 시도까지 매칭 안되면 에러

3. 페어 재매칭

- 안내 문구 출력 후 재매칭
- 아니오 하면 다시 코스, 레벨, 미션 선택

4. 페어 조회

- 과정, 레벨, 미션 선택하면 해당 미션의 페어 정보 출력
- 매칭 이력 없으면 없다고 안내

### 사전 제공 정보

- 크루 정보는 md파일로 제공됨
- 과정, 레벨 미션 정보는 다음과 같다.

```
## 과정
- 백엔드
- 프론트엔드

## 레벨
- 레벨1
- 레벨2
- 레벨3
- 레벨4
- 레벨5

## 미션
### 레벨1
- 자동차경주
- 로또
- 숫자야구게임

### 레벨2
- 장바구니
- 결제
- 지하철노선도

### 레벨3(없음)

### 레벨4
- 성능개선
- 배포

### 레벨5 (없음)
```

### 실행 결과 예시

```
기능을 선택하세요.
1. 페어 매칭
2. 페어 조회
3. 페어 초기화
Q. 종료
1

#############################################
과정: 백엔드 | 프론트엔드
미션:
  - 레벨1: 자동차경주 | 로또 | 숫자야구게임
  - 레벨2: 장바구니 | 결제 | 지하철노선도
  - 레벨3:
  - 레벨4: 성능개선 | 배포
  - 레벨5:
############################################
과정, 레벨, 미션을 선택하세요.
ex) 백엔드, 레벨1, 자동차경주
프론트엔드, 레벨1, 자동차경주

페어 매칭 결과입니다.
다비 : 신디
쉐리 : 덴버
제키 : 로드
라라 : 윌터
니콜 : 이브
린다 : 시저
보노 : 제시 : 제키

기능을 선택하세요.
1. 페어 매칭
2. 페어 조회
3. 페어 초기화
Q. 종료
1

#############################################
과정: 백엔드 | 프론트엔드
미션:
  - 레벨1: 자동차경주 | 로또 | 숫자야구게임
  - 레벨2: 장바구니 | 결제 | 지하철노선도
  - 레벨3:
  - 레벨4: 성능개선 | 배포
  - 레벨5:
############################################
과정, 레벨, 미션을 선택하세요.
ex) 백엔드, 레벨1, 자동차경주
프론트엔드, 레벨1, 자동차경주

매칭 정보가 있습니다. 다시 매칭하시겠습니까?
네 | 아니오
아니오

과정, 레벨, 미션을 선택하세요.
ex) 백엔드, 레벨1, 자동차경주
프론트엔드, 레벨1, 자동차경주
매칭 정보가 있습니다. 다시 매칭하시겠습니까?
네 | 아니오
네

페어 매칭 결과입니다.
이브 : 윌터
보노 : 제키
신디 : 로드
제시 : 린다
시저 : 라라
니콜 : 다비
리사 : 덴버 : 제키

기능을 선택하세요.
1. 페어 매칭
2. 페어 조회
3. 페어 초기화
Q. 종료
2

#############################################
과정: 백엔드 | 프론트엔드
미션:
  - 레벨1: 자동차경주 | 로또 | 숫자야구게임
  - 레벨2: 장바구니 | 결제 | 지하철노선도
  - 레벨3:
  - 레벨4: 성능개선 | 배포
  - 레벨5:
############################################
과정, 레벨, 미션을 선택하세요.
ex) 백엔드, 레벨1, 자동차경주
프론트엔드, 레벨1, 자동차경주

페어 매칭 결과입니다.
이브 : 윌터
보노 : 제키
신디 : 로드
제시 : 린다
시저 : 라라
니콜 : 다비
리사 : 덴버 : 제키

기능을 선택하세요.
1. 페어 매칭
2. 페어 조회
3. 페어 초기화
Q. 종료
3

초기화 되었습니다.

기능을 선택하세요.
1. 페어 매칭
2. 페어 조회
3. 페어 초기화
Q. 종료
Q
```

## 설계

설계 과정에서 가장 처음 고민했던건 미션마다의 페어 매칭 결과를 어떻게 저장할까? 였다. 결론으로는 Mission마다 객체를 생성 -> 그 객체 내부에 과정, 레벨, 미션, 매칭 결과를 담게 하기로 하였다.

일단 프로그램 순서를 설명하면 다음과 같다.

1. while문으로 Q나올 때까지 메인 로직 반복
2. command 받아옴 -> 검증
3. 해당 command에 맞는 내용 진행
4. 페어 매칭 -> 해당 조건에 맞는 미션이 있다면 -> 재매칭 여부 입력 받음
5. 재매칭 안하면 다시 미션 정보 입력부터
6. 재매칭 하면 재매칭
7. 재매칭 -> 안내 문구 출력 후 입력
8. 재매칭 yes면 재매칭, no면 다시 선택
9. 조회 -> 미션 선택 -> 결과 출력

그리고 책임 분리에 따라 다음과 같이 나누게 되었다.

### Controller

Controller는 많은 역할을 가지지 않고, 사용자와 내부 로직을 상호작용할 수 있도록 하려고 노력하였다.

- Command 입력 받음 -> command 검증 -> 맞는 메서드 실행 -> 반복
- 매칭 메서드 -> 미션 선택 입력 받음 -> 검증 -> 재입력 or MatchingService로 전달 -> 결과 return
- 조회 메서드 -> 미션 선택 -> MatchingService로 전달 -> 결과 return
- 초기화 메서드 -> 미션 선택 -> MatchingService로 전달 -> 결과 return
- 결과 확인 후 결과 출력 or 추가 입력
- 매칭 추가입력 -> 이미 미션 있으면 -> 재매칭 여부 -> 재매칭할거면 service의 재매칭
- 결과 처리

### MatchingService.js

Controller의 외부와의 상호작용을 제외한 가장 큰 부분의 내부 로직을 담당하게 된다.

- 매칭 메서드 -> 데이터 있는지 확인 -> 없으면 -> Matcher 내부 매칭 진행 -> 결과 return
- 매칭 메서드 -> 데이터 있는지 확인 -> 있으면 -> 결과 return
- 재매칭 -> Matcher 내부 재매칭 진행 -> 결과 return
- 조회 메서드 -> StatusHandler에 전달 -> 결과 return
- 초기화 메서드 -> ResetHandler에 전달 -> 결과 return

### Matcher

매칭 메서드와 재매칭 메서드로 크게 나뉜다.

1. 매칭 메서드

- 해당 미션 객체 가져옴
- 해당 미션에 해당되는 크루 수 만큼 숫자 배열 생성
- 같은 레벨에 해당되는 미션들의 매칭 결과 가져옴
- shuffle 결과와 매칭 결과 중복 여부 확인 (uniqueValidator)
- 안 겹칠 때까지 돌림(최대 3회) 안되면 그냥 에러 처리

2. 재매칭 메서드

- 매칭 메서드와 동일함
- 다만, 시작 부분에 해당 미션 객체의 매칭 결과를 초기화 해야 validate할 때 안걸림

### MissionRepo

- Mission 객체들을 담고 있는 class
- DataManager에서 필요로 하는 정보 가져다 줌
- DataManager에서 가공하는 정보 해당되는 미션에 넣음

### StatusHandler

- 원하는 정보 MissionRepo 통해 가져옴
- 정보 가공 및 command 추가 후 return

### ResetHandler

- 원하는 정보 MissionRepo 통해 가져옴
- 있으면 초기화 해달라고 요청 후 성공 return
- 없으면 없다 return

### Mission

- 과정
- 레벨
- 미션명
- 크루 목록
- 매칭 결과

### InputValidator

- 사용자 입력 형식 검증

### DataValidator

- MissionRepo에서 해당 미션 있는지 확인

### DataLauncher

- InputView에서 파일 읽어옴
- Mission 객체들 생성
- MissionRepo 생성
- return해서 Controller에 저장하도록

### Constants

- 입력 메세지
- 에러 메세지
- 출력 메세지
- 레벨별 미션 정보

## 구현 체크리스트

### Controller

- [x] initMission()
  - [x] DataLauncher 실행
  - [x] MissionRepo 생성 및 저장
  - [x] MatchingService 생성 및 저장
- [x] while문으로 감싸진 메인 메서드
  - [x] Command 입력 받음
  - [x] Command 검증
  - [x] command Q 아니면 command 다음으로 전달
  - [x] Command Q면 break
- [x] 미션 선택 입력 받는 메서드
- [x] 추가 입력
  - [x] 미션 선택 입력 받음
  - [x] DataValidator로 검증
  - [x] 검증 실패하면 재입력(try-catch)
  - [x] 성공하면 MatchingService로 Command와 미션 정보 전달 후 결과 return
  - [ ] 결과 가공
- [ ] 결과 가공
  - [ ] 결과가 재매칭 입력 받아야하면 입력 받아서 MatchingService 메인 로직으로 이동(command는 reset으로)
  - [ ] 결과 print

### MatchingService

- [ ] 메인 로직
  - [ ] command와 미션 정보 받음
  - [ ] command마다 해당 메서드 실행
  - [ ] 결과 return
- [ ] 매칭 메서드
  - [ ] 매칭 데이터 있는지 확인
  - [ ] 없으면 Matcher 매칭 메서드로 전달
  - [ ] 결과 return
  - [ ] 기존 데이터 있으면 재입력 여부 받으라는 결과 return
- [ ] 재매칭
  - [ ] Matcher 재매칭 메서드로 전달
  - [ ] 결과 return
- [ ] 조회 메서드
  - [ ] StatusHandler 생성
  - [ ] 메인 로직에 미션 정보 전달, 실행 후 결과 return
- [ ] 초기화 메서드
  - [ ] ResetHandler 생성
  - [ ] 메인 로직에 미션 정보 전달, 실행 후 결과 return

### Matcher

- [ ] 매칭 메서드
  - [ ] 해당 미션 객체 가져옴
  - [ ] 해당 미션에 해당되는 크루 수 만큼 숫자 배열 생성
  - [ ] 같은 레벨에 해당되는 미션들의 매칭 결과 가져옴
  - [ ] 랜덤 돌림
    - [ ] 돌린 횟수 저장
    - [ ] 매칭 결과 uniqueValidator로 확인
    - [ ] 안겹치면 통과
    - [ ] 겹치면 다시 돌림
    - [ ] 3회 돌렸는데 겹치면 걍 에러 처리(uniqueValidator로) 및 결과 fail
  - [ ] 결과 받아서 MissionRepo에 저장
  - [ ] 결과 return
- [ ] 재매칭 메서드
  - [ ] 해당 미션 객체 가져옴
  - [ ] 매칭 결과 초기화
  - [ ] 위의 매칭 메서드 실행

### MissionRepo

- [ ] Mission 객체들을 필드에 담고 있음
- [ ] 해당되는 미션 객체 return
- [ ] 같은 레벨에 있는 미션들의 매칭 결과 return
- [ ] 해당되는 미션의 매칭 결과 가공

### StatusHandler

- [ ] 미션 정보 가져옴
- [ ] 필요한 정보 가공 후 return

### ResetHandler

- [ ] 미션 정보 가져옴
- [ ] 있으면 초기화 요청 후 성공 return
- [ ] 없으면 없다 return

### Mission

- [ ] 과정명
- [ ] 레벨
- [ ] 미션명
- [ ] 크루 목록
- [ ] 매칭 결과

### InputValidator

- [ ] CommandValidate
- [ ] 미션 정보 검증
  - [ ] split
  - [ ] 과정명 검증
  - [ ] 레벨 검증
  - [ ] 미션 검증

### DataValidator

- [ ] MissionRepo에서 일치하는 정보 가져옴
- [ ] 없으면 error
- [ ] 있으면 패스~

## 구현
