## 설계

일단 사용자가 원하는 기능을 입력하면 진행되는 프로그램이라 경우에 따라 진행되는 내용이 다르다.

- 상영 정보 조회
- 좌석 예매
- 예매 취소
- 매출 통계

이렇게 나뉘며 하나하나 순서를 파악해보면

### 상영 정보 조회

1. 상영관 선택
2. 시간대 선택
3. 해당 정보 조회
4. 출력

### 좌석 예매

1. 상영관, 시간대 선택
2. 인원수 입력, 좌석번호 입력
3. 예매 가능 여부 확인 및 재입력
4. 예매처리
5. 예매 정보 출력

### 예매 취소

1. 예매 번호 입력
2. 예매 정보 확인 및 재입력
3. 취소 처리
4. 결과 출력

### 매출 통계

1. 상영관별 매출(총액, 건수)
2. 시간대별 매출(총액, 건수)
3. 총 예매 건수
4. 총 매출액
5. 평균 예매 금액 출력

### 종합적인 설계

일단 Controller의 역할을 어디까지 할지 고민을 해보았고, 다음과 같이 정리했다.

- 사용자 입력
- 사용자 입력 확인
- 사용자 입력 별로 서로 다른 메서드 이동
- 해당 내용 거쳐서 Q 입력 때까지 반복(while)
- 해당 메서드 이동
- 사용자 추가 입력
- 결과 출력까지

그럼 여기서 만약 좌석 예매나 예매 취소에서 적절하지 않은 내용이 들어오면 다시 사용자 input을 받게 해야한다.
그래서 사용자 입력 확인 후 서로 다른 메서드로 이동한 다음 어차피 다른 애들은 error 처리이기 때문에 일단 마지막을 return true로 하고, 좌석예매, 예매 취소의 경우에는 진행 여부 확인후 실패면 false return 하도록 했다 -> false면 다시 사용자 입력으로 돌아가도록(run? 실행)
<br />
가장 중요한 점은 예매 정보인데, 이 부분을 위해서 파일 분리를 다음과 같이 했다.

### Model

#### Database.js

- 예매 정보 담고 있음
- controller에서 생성 -> 모두가 공유하지는 않고, Parser, Worker와 공유

#### Parser.js

- DB 정보 가지고 있음
- 필요한 정보 DB에서 가져오는 역할

#### Worker.js

- DB 정보 가지고 있음
- 처리된 결과로 DB 변경

#### Validator.js

- Parser 정보 가지고 있음
- 입력 내용 검증
- 예매 가능 여부 확인(Parser와 상호작용)
- 취소 가능 여부 확인(Parser와 상호작용)

#### StatusManager.js

- Parser 정보 가지고 있음
- 정보 가져와서
- 가공
- return

#### PurchaseManager.js

- Parser, Worker 정보 가지고 있음
- 구매 내용 가지고 있음
- 예매처리(Worker)
- 결과 처리(Parser)
  - 좌석 등급 확인
  - 시간 할인
  - 단체 할인

#### CancelManager.js

- Parser, Worker 정보 가지고 있음
- 취소 처리(Worker)
- 결과 처리(Parser)
  - 금액

#### ResultProcessor.js

- 좌석 번호 입력 받아서 정리(상영 정보 조회)
- return할 결과들 만들어줌

#### Validator.js

- InputValidator
- 예매Validator

### Controller

#### Controller.js

- 가장 처음 play -> while 문으로 내부 내용 감쌈
  - 결과 받아서 break여부 판단
  - 결과 return
- 내부에 들어가는 메서드(사실상 시작)
  - 사용자 입력
  - 사용자 입력 확인
  - 사용자 입력 별로 다른 메서드 이동
  - 결과 받아서 return
- 각 command에 따른 메서드
  - 각자에 맞는 내용 진행
  - 결과 return
- 좌석 예매 부분 입력
- 예매 취소 부분 입력
- 결과 출력

### View

#### InputView.js

- 처음 command 입력
- 상영관 선택, 시간대 선택
- 인원수, 좌석번호 입력
- 예매 번호 입력

#### OutputView.js

- 상영 정보 출력
- 예매 정보 출력
- 취소 결과 출력
- 매출 통계 출력

## 구현 체크리스트

### Database

- [ ] 예매 정보 저장
- [ ] 예매 건수 저장(예매번호 만들기 위해)
- [ ] 총매출액 저장(통계용)
- [ ] 예매 정보에 추가하는 로직
- [ ] 예매 정보에서 삭제하는 로직
- [ ] 예매 정보 가져오는 로직

### Parser

- [ ] DB 정보 저장
- [ ] 상영관, 시간대와 일치하는 정보 return
- [ ] 예매 번호에 맞는 가격 return
- [ ] 모든 정보 return
- [ ] 총 예매건수 가져옴

### Worker

- [ ] DB 정보 저장
- [ ] 상영관, 시간대, 좌석번호, 금액 받아서 DB 정보에 추가
  - [ ] 예매 건수 받아서
  - [ ] DB에 예매번호 만들고
  - [ ] 해당 정보 추가요청
- [ ] 예매 정보 받아서 DB 삭제

### InfoManager

- [ ] Parser 정보 저장
- [ ] 상영관, 시간대 정보 가져와서 Parser에 넘김
- [ ] 정보 가져와서
- [ ] 가공(ResultProcessor.js)
- [ ] 결과 return

### StatusManager

- [ ] Parser 정보 저장
- [ ] 모든 정보 가져와서
- [ ] 상영관별로 나눔
  - [ ] 각 상영관 총액, 건수 계산
- [ ] 시간대별로 나눔
  - [ ] 각 시간대별 총액, 건수 계산
- [ ] 총 예매 건수 가져옴
- [ ] 총 매출액 가져옴
- [ ] 평균 예매 금액 계산
- [ ] 결과 return

### Calculator

- [ ] 정보들 가져와서(배열)
- [ ] 총액 계산
- [ ] 건수 계산

### PurchaseManager

- [ ] Worker 저장
- [ ] 구매 내용 저장
- [ ] 좌석 등급 확인
- [ ] 시간대 할인 확인
- [ ] 단체 할인 확인
- [ ] 상영관, 시간대, 좌석번호, 금액 Worker에 전달
- [ ] 예매 정보 가공
- [ ] 예매 정보 return

### CancelManager

- [ ] Worker, Parser 저장
- [ ] 금액 가져옴(Parser)
- [ ] 취소 처리(Worker)
- [ ] 결과 return

### ResultProcessor

- [ ] 예매 정보 가공
- [ ] 상영 정보 가공
- [ ] data 가공

### Validator

#### InputValidator

- [x] command 검증
- [x] 상영관 검증
- [x] 시간대 검증
- [ ] 인원수 숫자인지 검증
  - [ ] 숫자인가
  - [ ] 정수인가
  - [ ] 1이상인가
- [ ] 좌석 번호 형식 검증
  - [ ] 대문자 영어
  - [ ] 숫자인가(재사용)
  - [ ] 1이상 10이하인가
- [ ] 인원수에 맞는 입력인가

#### ReservationValidator

- [ ] Parser 받아옴
- [ ] 해당 상영관, 시간대가 있는가
- [ ] 그 정보에서! 해당 좌석 구매 가능한가
- [ ] 해당 예매번호 정보 있는가

### Controller

- [ ] 일단... 기존 예매처리 해야함
  - [x] InputView에서 파일 읽어서
  - [x] 가공(ResultProcessor)
  - [ ] 해당 예매정보마다 구매처리
- [x] 메인 로직
  - [x] while문으로 감쌈
  - [x] 사용자 command 입력
  - [x] 입력에 따라 메서드 실행
  - [ ] 결과 받아서 return
- [x] 정보 조회 command
  - [x] 상영관 입력 -> 검증
  - [x] 시간대 입력 -> 검증
  - [ ] 상영관, 시간대 InfoManager 전달
  - [ ] 결과 받음
- [ ] 좌석 예매 command
  - [ ] 상영관 입력 -> 검증
  - [ ] 시간대 입력 -> 검증
  - [ ] 인원수, 좌석번호 입력 -> 검증
  - [ ] PurchaseManager로 상영관, 시간대, 좌석번호 전달
  - [ ] 결과 받음
- [ ] 취소 command
  - [ ] 예매 번호 입력 -> 검증
  - [ ] CancelManager로 예매 번호 전달
  - [ ] 결과 받음
- [ ] 통계 command
  - [ ] 결과 받음
